{% extends "base.html" %}

{% block title %}Add Team - Tennis Database{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-10">
        <div class="card">
            <div class="card-header">
                <i class="fas fa-users"></i> Add New Team
            </div>
            <div class="card-body">
                <form method="POST">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <label for="id" class="form-label">
                                <i class="fas fa-hashtag"></i> Team ID *
                            </label>
                            <input type="number" class="form-control" id="id" name="id" 
                                   min="1" required 
                                   placeholder="e.g., 1001">
                            <div class="form-text">Unique identifier</div>
                        </div>
                        
                        <div class="col-md-9 mb-3">
                            <label for="name" class="form-label">
                                <i class="fas fa-users"></i> Team Name *
                            </label>
                            <input type="text" class="form-control" id="name" name="name" 
                                   required maxlength="255"
                                   placeholder="e.g., Smith - Tennis Center North">
                            <div class="form-text">Team name (often includes captain name and facility)</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="league_id" class="form-label">
                                <i class="fas fa-trophy"></i> League *
                            </label>
                            <select class="form-select" id="league_id" name="league_id" required>
                                <option value="">Select a league...</option>
                                {% for league in leagues %}
                                <option value="{{ league.id }}">
                                    {{ league.name }} ({{ league.year }})
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">League this team competes in</div>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="home_facility_id" class="form-label">
                                <i class="fas fa-building"></i> Home Facility *
                            </label>
                            <select class="form-select" id="home_facility_id" name="home_facility_id" required>
                                <option value="">Select a facility...</option>
                                {% for facility in facilities %}
                                <option value="{{ facility.id }}">
                                    {{ facility.name }}
                                    {% if facility.location %}
                                    <small class="text-muted"> - {{ facility.location }}</small>
                                    {% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">Team's home venue</div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="captain" class="form-label">
                            <i class="fas fa-user"></i> Team Captain *
                        </label>
                        <input type="text" class="form-control" id="captain" name="captain" 
                               required maxlength="255"
                               placeholder="e.g., Jane Smith">
                        <div class="form-text">Full name of the team captain</div>
                    </div>
                    
                    <!-- New Preferred Days Section -->
                    <div class="mb-3">
                        <label for="preferred_days" class="form-label">
                            <i class="fas fa-calendar-check"></i> Preferred Playing Days
                        </label>
                        <div class="form-check-container">
                            {% for day in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'] %}
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" 
                                       id="preferred_{{ day.lower() }}" 
                                       name="preferred_days" 
                                       value="{{ day }}">
                                <label class="form-check-label" for="preferred_{{ day.lower() }}">
                                    {{ day }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="form-text">
                            Select days when this team prefers to play matches. 
                            Leave empty if the team has no preference.
                        </div>
                    </div>
                    
                    <hr>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Add Team
                        </button>
                        <a href="{{ url_for('teams') }}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        <button type="button" class="btn btn-outline-info" onclick="generateTeamName()">
                            <i class="fas fa-magic"></i> Auto-Generate Name
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Help Section -->
        <div class="card mt-4">
            <div class="card-header">
                <i class="fas fa-info-circle"></i> Team Creation Guidelines
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6><i class="fas fa-lightbulb text-warning"></i> Naming Convention</h6>
                        <p class="small">Team names often include:</p>
                        <ul class="small">
                            <li>Captain's last name</li>
                            <li>Home facility name</li>
                            <li>Sometimes team number or nickname</li>
                        </ul>
                        <div class="bg-light p-2 rounded small mt-2">
                            <strong>Examples:</strong><br>
                            • Smith - Tennis Center North<br>
                            • Johnson - Westside Club<br>
                            • Wilson Team #1
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-check-circle text-success"></i> Requirements</h6>
                        <ul class="small">
                            <li>Team must be assigned to an existing league</li>
                            <li>Home facility must exist in the database</li>
                            <li>Team ID must be unique</li>
                            <li>Captain name is required for contact purposes</li>
                        </ul>
                        <div class="alert alert-info mt-2 p-2 small">
                            <i class="fas fa-info-circle"></i> If you don't see the league or facility you need, add them first.
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h6><i class="fas fa-calendar text-info"></i> Scheduling Preferences</h6>
                        <ul class="small">
                            <li>Preferred days help with match scheduling</li>
                            <li>System will try to schedule on preferred days first</li>
                            <li>Leave empty if team has no day preferences</li>
                            <li>Consider league's scheduling preferences too</li>
                        </ul>
                        <div class="mt-2">
                            <a href="{{ url_for('leagues') }}" class="btn btn-sm btn-outline-primary me-2">
                                <i class="fas fa-trophy"></i> View Leagues
                            </a>
                            <a href="{{ url_for('facilities') }}" class="btn btn-sm btn-outline-success">
                                <i class="fas fa-building"></i> View Facilities
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-focus on the first input
    document.getElementById('id').focus();
    
    // Add league change handler to show scheduling info
    document.getElementById('league_id').addEventListener('change', function() {
        const leagueId = this.value;
        if (leagueId) {
            showLeagueSchedulingInfo(leagueId);
        } else {
            hideLeagueSchedulingInfo();
        }
    });
});

function showLeagueSchedulingInfo(leagueId) {
    // Get the selected league's text to parse scheduling info
    const leagueSelect = document.getElementById('league_id');
    const selectedOption = leagueSelect.options[leagueSelect.selectedIndex];
    
    // Create or update scheduling info alert
    let alertDiv = document.getElementById('league-scheduling-alert');
    if (!alertDiv) {
        alertDiv = document.createElement('div');
        alertDiv.id = 'league-scheduling-alert';
        alertDiv.className = 'alert alert-info mt-3';
        
        // Insert after the league select
        const leagueContainer = leagueSelect.closest('.col-md-6');
        leagueContainer.appendChild(alertDiv);
    }
    
    alertDiv.innerHTML = `
        <i class="fas fa-info-circle"></i>
        <strong>League Scheduling:</strong> ${selectedOption.text}<br>
        <small>Consider selecting team preferred days that align with this league's scheduling preferences.</small>
    `;
}

function hideLeagueSchedulingInfo() {
    const alertDiv = document.getElementById('league-scheduling-alert');
    if (alertDiv) {
        alertDiv.remove();
    }
}

function generateTeamName() {
    const captain = document.getElementById('captain').value.trim();
    const facilitySelect = document.getElementById('home_facility_id');
    const facilityName = facilitySelect.options[facilitySelect.selectedIndex]?.text;
    
    if (captain && facilityName && facilityName !== 'Select a facility...') {
        // Extract captain's last name (assume last word is last name)
        const nameParts = captain.split(' ');
        const lastName = nameParts[nameParts.length - 1];
        
        // Extract facility name (remove location part if present)
        const facilityNameOnly = facilityName.split(' - ')[0];
        
        const teamName = `${lastName} - ${facilityNameOnly}`;
        document.getElementById('name').value = teamName;
    } else {
        alert('Please enter captain name and select a home facility first.');
    }
}

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const id = document.getElementById('id').value;
    const name = document.getElementById('name').value.trim();
    const leagueId = document.getElementById('league_id').value;
    const facilityId = document.getElementById('home_facility_id').value;
    const captain = document.getElementById('captain').value.trim();
    
    if (!id || id < 1) {
        alert('Please enter a valid team ID (must be a positive number)');
        e.preventDefault();
        return;
    }
    
    if (!name) {
        alert('Please enter a team name');
        e.preventDefault();
        return;
    }
    
    if (!leagueId) {
        alert('Please select a league');
        e.preventDefault();
        return;
    }
    
    if (!facilityId) {
        alert('Please select a home facility');
        e.preventDefault();
        return;
    }
    
    if (!captain) {
        alert('Please enter the team captain name');
        e.preventDefault();
        return;
    }
    
    // Optional: Warn if no preferred days selected
    const preferredDays = document.querySelectorAll('input[name="preferred_days"]:checked');
    if (preferredDays.length === 0) {
        const proceed = confirm('No preferred playing days selected. The team will be available for scheduling on any day. Continue?');
        if (!proceed) {
            e.preventDefault();
            return;
        }
    }
});

// Update team name suggestion when captain or facility changes
document.getElementById('captain').addEventListener('blur', function() {
    if (this.value.trim() && document.getElementById('home_facility_id').value && !document.getElementById('name').value.trim()) {
        generateTeamName();
    }
});

document.getElementById('home_facility_id').addEventListener('change', function() {
    if (this.value && document.getElementById('captain').value.trim() && !document.getElementById('name').value.trim()) {
        generateTeamName();
    }
});
</script>
{% endblock %}
